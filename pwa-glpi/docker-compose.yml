version: "3.7"

services:
  ticketsign-client:
    image: ghcr.io/jhamfgit/ticketsign-client:latest
    networks:
      - jhamfstack
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints:
          - node.role == manager
      labels:
        - traefik.enable=true
        - traefik.http.routers.ticketsign.rule=Host(`ticketsign.jhamf.com`)
        - traefik.http.services.ticketsign.loadbalancer.server.port=80
        - traefik.http.routers.ticketsign.entrypoints=websecure
        - traefik.http.routers.ticketsign.tls.certresolver=letsencryptresolver

  ticketsign-server:
    image: ghcr.io/jhamfgit/ticketsign-server:latest
    networks:
      - jhamfstack
    environment:
      - PORT=5000
      - MONGO_URI=mongodb://mongo:27017/ticketsign
      - GLPI_API_URL=https://service.jhamf.com/apirest.php
      - GLPI_APP_TOKEN=RVzlOUp4BmZIzHDQ4IQ6pz8ajxg85lXYbqhM9Ntj
      - GLPI_USER_TOKEN=vy58wK7lqPjKPh01CtBrjE4xZfeNvXhYV4fKKEUz
      - WHATSAPP_PHONE_ID=849555261580952
      - WHATSAPP_WABA_ID=848382954344504
      - WHATSAPP_TOKEN=EAAVX5xu2Jq4BQnDHUyZAYdJRFlsli5thLu6TxGIYyF2zvNklOLPJSszXlh0rgV8rgCtfMVCNj5fOJ9ZBvMfEba6k6jqfDKnErSMFccJrbfxy1G79wnMOjk3VC7TTgwG8O2dkVFimIvZAfv8ZCc9ErZAeycpeAjXW12KzHGnZB8urmm5SJoXwNm9MQUCq4SQgZDZD
      - WHATSAPP_TEMPLATE_NAME=notificacion_tarea
      - WHATSAPP_LANG=es_CO
      - JWT_SECRET=677993ce631061a6ce22201bc7137bf4
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints:
          - node.role == manager
      labels:
        - traefik.enable=true
        - traefik.http.routers.ticketsign-api.rule=Host(`api-ticketsign.jhamf.com`)
        - traefik.http.services.ticketsign-api.loadbalancer.server.port=5000
        - traefik.http.routers.ticketsign-api.entrypoints=websecure
        - traefik.http.routers.ticketsign-api.tls.certresolver=letsencryptresolver

  mongo:
    image: mongo:latest
    networks:
      - jhamfstack
    volumes:
      - ticketsign_data:/data/db
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints:
          - node.role == manager

volumes:
  ticketsign_data:


networks:
  jhamfstack:
    external: true
